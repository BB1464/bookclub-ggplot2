[["index.html", "ggplot2 Book Club Welcome", " ggplot2 Book Club The R4DS Online Learning Community 2021-11-23 Welcome This is a companion for the book ggplot2: Elegant Graphics for Data Analysis by Hadley Wickham, Danielle Navarro, and Thomas Lin Pedersen. This companion is available at https://r4ds.github.io/bookclub-ggplot2. This website is being developed by the R4DS Online Learning Community. Follow along, and join the community to participate. This companion follows the R4DS Online Learning Community Code of Conduct. "],["book-club-meetings.html", "Book club meetings", " Book club meetings Each week, a volunteer will present a chapter from the book. This is the best way to learn the material. Presentations will usually consist of a review of the material, a discussion, and/or a demonstration of the principles presented in that chapter. More information about how to present is available in the github repo. Presentations will be recorded, and will be available on the R4DS Online Learning Community YouTube Channel. "],["introduction.html", "Chapter 1 Introduction", " Chapter 1 Introduction Learning objectives: {These are nice to have, but take some extra work. It’s ok to skip these if necessary.} {Cohort 1 of this club did not create slides for the introduction chapter.} "],["slide-1-title.html", "1.1 {Slide 1 title}", " 1.1 {Slide 1 title} {Create slides as sections, but keep them short like a slide.} "],["meeting-videos.html", "1.2 Meeting Videos", " 1.2 Meeting Videos 1.2.1 Cohort 1 Meeting chat log "],["first-steps.html", "Chapter 2 First Steps ", " Chapter 2 First Steps "],["general-housekeeping-items.html", "2.1 General Housekeeping Items", " 2.1 General Housekeeping Items This is a learning opportunity so feel free to ask any question at any time. Take time to learn the theory, in particular Grammar of Graphics. Please do the chapter exercises. Second-best learning opportunity! Please plan to facilitate one of the discussions. Best learning opportunity! "],["learning-objectives.html", "2.2 Learning Objectives", " 2.2 Learning Objectives Brief introduction to ggplot’s capabilities Learn about key components of every plot: data, aesthetics, geoms Learn about faceting See a few different geoms Modify the axes Save the plot to disk "],["main-data-set.html", "2.3 Main data set", " 2.3 Main data set For this chapter, we’ll mainly use the mpg dataset that comes with ggplot. mpg ## # A tibble: 234 × 11 ## manufacturer model displ year cyl trans drv cty hwy fl class ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; ## 1 audi a4 1.8 1999 4 auto… f 18 29 p comp… ## 2 audi a4 1.8 1999 4 manu… f 21 29 p comp… ## 3 audi a4 2 2008 4 manu… f 20 31 p comp… ## 4 audi a4 2 2008 4 auto… f 21 30 p comp… ## 5 audi a4 2.8 1999 6 auto… f 16 26 p comp… ## 6 audi a4 2.8 1999 6 manu… f 18 26 p comp… ## 7 audi a4 3.1 2008 6 auto… f 18 27 p comp… ## 8 audi a4 quattro 1.8 1999 4 manu… 4 18 26 p comp… ## 9 audi a4 quattro 1.8 1999 4 auto… 4 16 25 p comp… ## 10 audi a4 quattro 2 2008 4 manu… 4 20 28 p comp… ## # … with 224 more rows cty and hwy are miles per gallon measures displ is engine displacement in litres drv is front wheel (f), rear wheel (r) or four wheel (4) model is the model of the car class is two-seater, SUV, compact, etc. "],["components-of-every-plot.html", "2.4 Components of every plot", " 2.4 Components of every plot Three components ggplot(mpg, aes(x = displ, y = hwy)) + geom_point() It’s allowable to omit the x = and y = arguments of aes. In other words, aes(displ, hwy) would be valid for this plot. "],["a-few-exercises.html", "2.5 A few exercises", " 2.5 A few exercises What does the below plot show? Is it useful? How could it improve? ggplot(mpg, aes(model, manufacturer)) + geom_point() + theme(axis.text.x = element_text(angle = 90, hjust = 1)) - Practice coding the following plots. Anticipate what the output will look like. Become familiar with the common components of the plots. ggplot(mpg, aes(cty, hwy)) + geom_point() ggplot(diamonds, aes(carat, price)) + geom_point() ggplot(economics, aes(date, unemploy)) + geom_line() ggplot(mpg, aes(cty)) + geom_histogram() "],["other-aesthetic-attributes.html", "2.6 Other aesthetic attributes", " 2.6 Other aesthetic attributes color, shape and size can be mapped to variables in the data The class variable of the mpg dataset has seven unique values. The plot can assign a specific color to each value by mapping class to color within the aesthetic function. ## # A tibble: 7 × 1 ## class ## &lt;chr&gt; ## 1 compact ## 2 midsize ## 3 suv ## 4 2seater ## 5 minivan ## 6 pickup ## 7 subcompact ggplot(mpg, aes(displ, hwy, color = class)) + geom_point() Including a color assignment outside the aesthetic of the geometry layer will make all of the points that color. ggplot(mpg, aes(displ, hwy)) + geom_point(color = &quot;blue&quot;) Mapping a variable to shape and color adds some diversity and information to the plot. ggplot(mpg, aes(displ, hwy, shape = drv, color = drv)) + geom_point() Mapping a variable to size can also add some new insights. ggplot(mpg, aes(manufacturer, drv, size = displ)) + geom_point() + theme(axis.text.x = element_text(angle = 90)) "],["faceting.html", "2.7 Faceting", " 2.7 Faceting Faceting creates graphics by splitting the data into subsets and displaying the same graph for each subset. Really helpful if there are lots of values, making color/shape less meaningful. ggplot(mpg, aes(displ, hwy)) + geom_point() + facet_wrap(~class) Exercise: Use faceting to explore the three-way relationship between fuel economy, engine size and number of cylinders. How does faceting by number of cylinders change your assessment of the relationship between engine size and fuel economy? NOT FACETED BY cyl ggplot(mpg, aes(displ, hwy)) + geom_point() FACETED BY cyl ggplot(mpg, aes(displ, hwy)) + geom_point() + facet_wrap(~cyl) "],["geoms.html", "2.8 Geoms", " 2.8 Geoms The geom_point() geom gives a familiar scatterplot. Other geoms include: geom_smooth() which fits a smooth line to the data check help to see geom_smooth’s arguments like method, se or span. ggplot(mpg, aes(displ, hwy)) + geom_point() + geom_smooth() geom_boxplot() which generates a box-and-whisker plot check help to see geom_boxplot’s arguments like outlier arguments, and coef which adjusts the whisker length. ggplot(mpg, aes(drv, hwy)) + geom_boxplot() consider boxplot variants like geom_jitter and geom_violin ggplot(mpg, aes(drv, hwy)) + geom_jitter() ggplot(mpg, aes(drv, hwy)) + geom_violin() geom_histogram which generates a histogram and geom_freqpoly which generates a frequency polygon check help to see geom_histogram’s arguments like position and binwidth. ggplot(mpg, aes(hwy)) + geom_histogram() ## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`. ggplot(mpg, aes(hwy)) + geom_freqpoly() ## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`. geom_bar which generates a bar chart check help to see geom_bar’s arguments like position and width ggplot(mpg, aes(manufacturer)) + geom_bar() We’ll take a second here to talk about the stat argument. Note that in the first bar chart, the y-axis shows the number of observations labeled as count. mpg %&gt;% group_by(manufacturer) %&gt;% count() ## # A tibble: 15 × 2 ## # Groups: manufacturer [15] ## manufacturer n ## &lt;chr&gt; &lt;int&gt; ## 1 audi 18 ## 2 chevrolet 19 ## 3 dodge 37 ## 4 ford 25 ## 5 honda 9 ## 6 hyundai 14 ## 7 jeep 8 ## 8 land rover 4 ## 9 lincoln 3 ## 10 mercury 4 ## 11 nissan 13 ## 12 pontiac 5 ## 13 subaru 14 ## 14 toyota 34 ## 15 volkswagen 27 What if you wanted to sum a certain value for each manufacturer, then you have to tell ggplot “don’t just return the number of observations, add up the values in this certain column”. You do this using the stat argument and by specifying a new variable for the y-axis. For instance, we might be interested in knowing the total price of all vehicles in the data set for each manufacturer. It may be interesting to see if four Land Rovers are more expensive than 14 Hyundais. (No disrepect to Hyundai drivers… I am one myself!) Unfortunately, price isn’t a variable in this dataset so, let’s use displ instead. The sum of displ isn’t particularly meaningful in real life, but it illustrates the use of the stat argument. This graph below uses displ for y in the aesthetic and uses the stat of identity so that it sums the total displacement for each manufacturer. ggplot(mpg, aes(manufacturer, displ)) + geom_bar(stat = &quot;identity&quot;) This plot now shows the total displacement. mpg %&gt;% group_by(manufacturer) %&gt;% summarize(sum(displ)) ## # A tibble: 15 × 2 ## manufacturer `sum(displ)` ## &lt;chr&gt; &lt;dbl&gt; ## 1 audi 45.8 ## 2 chevrolet 96.2 ## 3 dodge 162 ## 4 ford 113. ## 5 honda 15.4 ## 6 hyundai 34 ## 7 jeep 36.6 ## 8 land rover 17.2 ## 9 lincoln 16.2 ## 10 mercury 17.6 ## 11 nissan 42.5 ## 12 pontiac 19.8 ## 13 subaru 34.4 ## 14 toyota 100. ## 15 volkswagen 60.9 geom_line and geom_path which generates a line chart or path chart (useful for time series data) check help to see geom_line’s arguments like lineend and arrow ggplot(economics, aes(date, unemploy / pop)) + geom_line() ggplot(economics, aes(date, uempmed)) + geom_line() To investigate these plots further, we can draw them on the same plot. year &lt;- function(x) as.POSIXlt(x)$year + 1900 ggplot(economics, aes(unemploy / pop, uempmed)) + geom_path(color = &quot;grey50&quot;) + geom_point(aes(color = year(date))) "],["modifying-the-axes.html", "2.9 Modifying the Axes", " 2.9 Modifying the Axes xlab() and ylab() modify the axis labels ggplot(mpg, aes(cty, hwy)) + geom_point(alpha = 1/3) ggplot(mpg, aes(cty, hwy)) + geom_point(alpha = 1/3) + xlab(&quot;city driving (mpg)&quot;) + ylab(&quot;highway driving (mpg)&quot;) # remove labels with NULL ggplot(mpg, aes(cty, hwy)) + geom_point(alpha = 1/3) + xlab(NULL) + ylab(NULL) xlim() and ylim() modify the limits of the axes (boundaries) ggplot(mpg, aes(drv, hwy)) + geom_jitter(width = 0.25) ggplot(mpg, aes(drv, hwy)) + geom_jitter(width = 0.25) + xlim(&quot;f&quot;, &quot;r&quot;) + ylim(20, 30) ## Warning: Removed 139 rows containing missing values (geom_point). "],["output.html", "2.10 Output", " 2.10 Output Save the plot to a variable p &lt;- ggplot(mpg, aes(displ, hwy, color = factor(cyl))) + geom_point() Then print it print(p) Save it to disk ggsave(&quot;plot.png&quot;, p, width = 5, height = 5) Describe its structure summary(p) ## data: manufacturer, model, displ, year, cyl, trans, drv, cty, hwy, fl, ## class [234x11] ## mapping: x = ~displ, y = ~hwy, colour = ~factor(cyl) ## faceting: &lt;ggproto object: Class FacetNull, Facet, gg&gt; ## compute_layout: function ## draw_back: function ## draw_front: function ## draw_labels: function ## draw_panels: function ## finish_data: function ## init_scales: function ## map_data: function ## params: list ## setup_data: function ## setup_params: function ## shrink: TRUE ## train_scales: function ## vars: function ## super: &lt;ggproto object: Class FacetNull, Facet, gg&gt; ## ----------------------------------- ## geom_point: na.rm = FALSE ## stat_identity: na.rm = FALSE ## position_identity "],["layers.html", "Chapter 3 Layers", " Chapter 3 Layers Introduction Based on the Grammar of Graphics, GGplot2 encourages you to build plots in a structured manner building upon on your plots with various layers. The purposes of the layers are: to display the data. to display a statistical summary of the data. to add metadata such as context, annotations or references to your plot. "],["layers-chapters.html", "3.1 Layers: Chapters", " 3.1 Layers: Chapters The section on layers is broken up into the following chapters: Chapter 3. Individual Geoms Chapter 4. Collective Geoms Chapter 5. Statistical Summaries Chapter 6. Maps Chapter 7. Networks Chapter 8. Annotations Chapter 9. Arranging Plots "],["individual-geoms.html", "Chapter 4 Individual Geoms", " Chapter 4 Individual Geoms Geoms are the fundamental building blocks of ggplot2. Most of the geoms are associated with a named plot. Some geoms can be added on to low-level geoms to create more complex plots. To find out more about individual geoms see their documentation. "],["scatterplot.html", "4.1 Scatterplot:", " 4.1 Scatterplot: ggplot(mpg, aes(x = displ, y = hwy)) + geom_point() "],["line-plot.html", "4.2 Line plot:", " 4.2 Line plot: ggplot(economics, aes(date, unemploy / pop)) + geom_line() "],["histogram.html", "4.3 Histogram:", " 4.3 Histogram: ggplot(mpg, aes(hwy)) + geom_histogram() ## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`. "],["bar-chart.html", "4.4 Bar chart", " 4.4 Bar chart ggplot(mpg, aes(manufacturer)) + geom_bar() ## geom_path() connects points in order of appearance. p + geom_path() "],["geom_polygon-draws-polygons-which-are-filled-paths..html", "4.5 geom_polygon() draws polygons which are filled paths.", " 4.5 geom_polygon() draws polygons which are filled paths. p + geom_polygon() "],["geom_line-connects-points-from-left-to-right..html", "4.6 geom_line() connects points from left to right.", " 4.6 geom_line() connects points from left to right. p + geom_line() "],["what-low-level-geoms-are-used-to-draw-geom_smooth.html", "4.7 What low-level geoms are used to draw geom_smooth()?", " 4.7 What low-level geoms are used to draw geom_smooth()? Geom_smooth() fits a smoother to data, displaying the smooth and its standard error, allowing you to see a dominant pattern within a scatterplot with a lot of “noise”. The low level geom for geom_smooth() are geom_path(), geom_area() and geom_point(). ggplot(mpg, aes(displ, hwy)) + geom_point() + geom_smooth() ## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39; "],["what-low-level-geoms-are-used-to-draw-geom_boxplot.html", "4.8 What low-level geoms are used to draw geom_boxplot()?", " 4.8 What low-level geoms are used to draw geom_boxplot()? Box plots are used to summarize the distribution of a set of points using summary statistics. The low level geom for geom_boxplot() are geom_rect(), geom_line() and geom_point(). ggplot(mpg, aes(drv, hwy)) + geom_boxplot() "],["what-low-level-geoms-are-used-to-draw-geom_violin.html", "4.9 What low-level geoms are used to draw geom_violin()?", " 4.9 What low-level geoms are used to draw geom_violin()? Violin plots show a compact representation of the density of the distribution highlighting the areas where most of the points are found. The low level geom for geom_violin() are geom_area() and geom_path(). ggplot(mpg, aes(drv, hwy)) + geom_violin() "],["collective-geoms.html", "Chapter 5 Collective Geoms ", " Chapter 5 Collective Geoms "],["general-housekeeping-items-1.html", "5.1 General Housekeeping Items", " 5.1 General Housekeeping Items This is a learning opportunity so feel free to ask any question at any time. Take time to learn the theory, in particular Grammar of Graphics. Please do the chapter exercises. Second-best learning opportunity! Please plan to facilitate one of the discussions. Best learning opportunity! "],["learning-objectives-1.html", "5.2 Learning Objectives", " 5.2 Learning Objectives Understand the difference between individual geoms and collective geoms Explore some plots that use individual and collective geoms together Reinforce understand of the Grammar of Graphics (particularly the use of layers) to create plots "],["quick-intuition-on-collective-geoms.html", "5.3 Quick Intuition on Collective Geoms", " 5.3 Quick Intuition on Collective Geoms Last chapter was on individual geoms. This chapter is on collective geoms. Oversimplification (but maybe useful) individual numbers vs the sum of the numbers sum converts a series of numbers (“individual”): 4, 7, 9, 3, 3 to a single number (“collective”): 26 home prices under individual geoms each home price has a point on a plot/table under collective geoms we may use median as a single number that summarizes all individuals This blog post by Simon Jackson illustrates these foundations using mtcars. The points are individual geoms and the bars are a collective geom showing the average of the individual observations. id &lt;- mtcars %&gt;% tibble::rownames_to_column() %&gt;% as_tibble() %&gt;% mutate(am = factor(am, levels = c(0, 1), labels = c(&quot;automatic&quot;, &quot;manual&quot;))) gd &lt;- id %&gt;% group_by(am) %&gt;% summarise(hp = mean(hp)) ggplot(id, aes(x = am, y = hp, color = am, fill = am)) + geom_bar(data = gd, stat = &quot;identity&quot;, alpha = 0.3) + ggrepel::geom_text_repel(aes(label = rowname), color = &quot;black&quot;, size = 2.5, segment.color = &quot;grey&quot;) + geom_point() + guides(color = &quot;none&quot;, fill = &quot;none&quot;) + theme_bw() + labs( title = &quot;Car horespower by transmission type&quot;, x = &quot;Transmission&quot;, y = &quot;Horsepower&quot; ) Next, a separate longitudinal study from the blog post (because the book example is also a longitudinal study). This example uses the ourworldindata dataset which shows healthcare spending per country over time. #library(devtools) #install_github(&quot;drsimonj/ourworldindata&quot;) library(ourworldindata) id &lt;- financing_healthcare %&gt;% filter(continent %in% c(&quot;Oceania&quot;, &quot;Europe&quot;) &amp; between(year, 2001, 2005)) %&gt;% select(continent, country, year, health_exp_total) %&gt;% na.omit() raw data id ## # A tibble: 275 × 4 ## continent country year health_exp_total ## &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; ## 1 Europe Albania 2001 198. ## 2 Europe Albania 2002 225. ## 3 Europe Albania 2003 236. ## 4 Europe Albania 2004 264. ## 5 Europe Albania 2005 277. ## 6 Europe Andorra 2001 1432. ## 7 Europe Andorra 2002 1565. ## 8 Europe Andorra 2003 1601. ## 9 Europe Andorra 2004 1662. ## 10 Europe Andorra 2005 1794. ## # … with 265 more rows individual observations are at the combined country-year level. For the purposes of plotting, though, the “individual geom” will just be the country and all of the yearly observations for each country. gd &lt;- id %&gt;% group_by(continent, year) %&gt;% summarise(health_exp_total = mean(health_exp_total)) ggplot(id, aes(x = year, y = health_exp_total, color = continent)) + geom_line(aes(group = country), alpha = 0.3) + geom_line(data = gd, alpha = 0.8, size = 3) + theme_bw() + labs( title = &quot;Changes in healthcare spending\\nacross countries and world regions&quot;, x = NULL, y = &quot;Total healthcare investment ($)&quot;, color = NULL ) "],["from-the-ggplot2-book.html", "5.4 From the ggplot2 book", " 5.4 From the ggplot2 book dataset called Oxboys which shows the age and corresponding height of 26 boys from Oxford. also a longitudinal study. note that the age is standardized. data(Oxboys, package = &quot;nlme&quot;) head(Oxboys, 9) ## Grouped Data: height ~ age | Subject ## Subject age height Occasion ## 1 1 -1.0000 140.5 1 ## 2 1 -0.7479 143.4 2 ## 3 1 -0.4630 144.8 3 ## 4 1 -0.1643 147.1 4 ## 5 1 -0.0027 147.7 5 ## 6 1 0.2466 150.2 6 ## 7 1 0.5562 151.7 7 ## 8 1 0.7781 153.3 8 ## 9 1 0.9945 155.8 9 5.4.1 Multiple Groups, One Aesthetic As the book says: In many situations, you want to separate your data into groups, but render them in the same way. In other words, you want to be able to distinguish individual subjects but not identify them. sometimes you want the individual geom to be a group of observations for the same individual. you do this by adding a group argument to the aesthetic. If you’re trying to figure out which variable to use as the grouping variable, fill in the blank “I have multiple observations for each _____”. Or for longitudinal studies, “I want to plot one line over time for each _____”. What’s the grouping variable for Oxboys? In the case of Oxboys, we want to plot a line over time for each boy, so Subject is the grouping variable in the aesthetic. ggplot(Oxboys, aes(age, height, group = Subject)) + geom_point() + geom_line() incorrectly specifying the grouping variable leads to a “characteristic sawtooth appearance”. ggplot(Oxboys, aes(age, height)) + geom_point() + geom_line() 5.4.2 Different Groups on Different Layers From the book: Sometimes we want to plot summaries that use different levels of aggregation: one layer might display individuals, while another displays an overall summary. now that we have plotted individual geoms, let’s add a collective geom which is the trendline for all boys together. ggplot(Oxboys, aes(age, height, group = Subject)) + geom_line() + geom_point() + geom_smooth(method = &quot;lm&quot;, se = FALSE) ## `geom_smooth()` using formula &#39;y ~ x&#39; #&gt; `geom_smooth()` using formula &#39;y ~ x&#39; something doesn’t look right expecting a collective geom (one summary line for all subjects), but we got individual geoms again – a trendline for each individual instead of a trendline for all individuals. “grouping controls both the display of the geoms, and the operation of the stats: one statistical transformation is run for each group”. we got multiple geom_smooths because we had the grouping variable in the ggplot line so the grouping flows down to all layers of the plot to get what we intend, we need to uncouple the grouping variable at the ggplot layer and add it where we want the grouping to happen, namely only at the geom_line layer. That allows the default grouping from the ggplot layer (i.e., no special grouping or just group on the whole dataset) to flow down to the geom_smooth layer. ggplot(Oxboys, aes(age, height)) + geom_line(aes(group = Subject)) + geom_point() + geom_smooth(method = &quot;lm&quot;, size = 2, se = FALSE) ## `geom_smooth()` using formula &#39;y ~ x&#39; #&gt; `geom_smooth()` using formula &#39;y ~ x&#39; 5.4.3 Overriding the Default Grouping In the last exercise, we finally got the grouping right. This hints at the approach of overriding the default grouping. By adding the grouping to geom_line, we overrode the default grouping, which was “no special grouping”. Here’s another example to help illustrate this point a little better. Thanks to this blog post. Subtitles are added to these plots to describe what’s going on. ggplot(mpg, aes(drv, hwy)) + geom_jitter() + stat_boxplot(fill = NA) + labs(subtitle = &quot;stat_boxplot automatically uses the groups set by the categorical variable drv.\\nNotice that there is only one boxplot for each value of drv.&quot;) ggplot(mpg, aes(drv, hwy, color = factor(year))) + geom_jitter() + stat_boxplot(fill = NA) + labs(subtitle = &quot;by now adding color based on year, it creates a new group for the boxplots as well,\\nand there are now two for each categorical. This may not be what you want.&quot;) ggplot(mpg, aes(drv, hwy, color = factor(year))) + geom_jitter() + stat_boxplot(fill = NA, aes(group = drv)) + labs(subtitle = &quot;we override the default or earlier grouping by adding\\na group -- inside the aes -- on the layer where we want it&quot;) 5.4.4 A couple of exercises mpg %&gt;% head(2) ## # A tibble: 2 × 11 ## manufacturer model displ year cyl trans drv cty hwy fl class ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; ## 1 audi a4 1.8 1999 4 auto(l5) f 18 29 p compa… ## 2 audi a4 1.8 1999 4 manual(m5) f 21 29 p compa… #Draw a boxplot of hwy for each value of cyl, without turning cyl into a factor. What extra aesthetic do you need to set? # Wrong... but cyl is an integer data type -- are integers considered continuous? ggplot(mpg, aes(cyl, hwy)) + geom_boxplot() ## Warning: Continuous x aesthetic -- did you forget aes(group=...)? # Right ggplot(mpg, aes(cyl, hwy, group = as.factor(cyl))) + geom_boxplot() #Modify the following plot so that you get one boxplot per integer value of displ. ggplot(mpg, aes(displ, cty)) + geom_boxplot() ## Warning: Continuous x aesthetic -- did you forget aes(group=...)? # probably better ways to do this, especially ways to make the boxplot line up with the x-axis ggplot(mpg, aes(x = ceiling(displ), cty, group = ceiling(displ))) + geom_boxplot() 5.4.5 Matching Aesthetics to Graphic Objects (Not covered in the preso) "],["statistical-summaries.html", "Chapter 6 Statistical Summaries", " Chapter 6 Statistical Summaries Learning Objectives: Use ggplot2 to plot possible uncertainty in your data Determine which geometric object (geom) best presents your type of data "],["defintions-in-this-chapter.html", "6.1 Defintions (in this Chapter)", " 6.1 Defintions (in this Chapter) discrete value: a finite number, something that is countable with beginning and end (input user definition welcomed) continuous value: infinite number, something that never ends. Infinity is continous. (input user definition welcomed) grobs: graphical object overplotting: too much data on scatterplot making underlying relationships obscure "],["revealing-uncertainty.html", "6.2 Revealing Uncertainty", " 6.2 Revealing Uncertainty Four primary types of geometric objects (geom) are used: 1. Discrete x, range: geom_errorbar(), geom_linerange() 2. Discrete x, range &amp; center: geom_crossbar(), geom_pointrange() 3. Continuous x, range: geom_ribbon() 4. Continuous x, range &amp; center: geom_smooth(stat = \"identity\") y &lt;- c(18, 11, 16) df &lt;- data.frame(x = 1:3, y = y, se = c(1.2, 0.5, 1.0)) base &lt;- ggplot(df, aes(x, y, ymin = y - se, ymax = y + se)) base + geom_crossbar() base + geom_pointrange() base + geom_smooth(stat = &quot;identity&quot;) df ## x y se ## 1 1 18 1.2 ## 2 2 11 0.5 ## 3 3 16 1.0 base + geom_errorbar() base + geom_linerange() base + geom_ribbon() "],["weighted-data.html", "6.3 Weighted Data", " 6.3 Weighted Data If each row of your dataframe contains multiple observations, we can use a weight to visually give scale to observations # Unweighted ggplot(midwest, aes(percwhite, percbelowpoverty)) + geom_point() # Weight by population ggplot(midwest, aes(percwhite, percbelowpoverty)) + geom_point(aes(size = poptotal / 1e6)) + scale_size_area(&quot;Population\\n(millions)&quot;, breaks = c(0.5, 1, 2, 4)) # Unweighted ggplot(midwest, aes(percwhite, percbelowpoverty)) + geom_point() + geom_smooth(method = lm, size = 1) ## `geom_smooth()` using formula &#39;y ~ x&#39; # Weighted by population ggplot(midwest, aes(percwhite, percbelowpoverty)) + geom_point(aes(size = poptotal / 1e6)) + geom_smooth(aes(weight = poptotal), method = lm, size = 1) + scale_size_area(guide = &quot;none&quot;) ## `geom_smooth()` using formula &#39;y ~ x&#39; ggplot(midwest, aes(percbelowpoverty)) + geom_histogram(binwidth = 1) + ylab(&quot;Counties&quot;) ggplot(midwest, aes(percbelowpoverty)) + geom_histogram(aes(weight = poptotal), binwidth = 1) + ylab(&quot;Population (1000s)&quot;) Question for the group: Is the above ylab correct? Check out the next two figures, can you see the difference? ggplot(midwest, aes(percbelowpoverty)) + geom_histogram(aes(weight = poptotal/1e3), binwidth = 1) + ylab(&quot;Population (1000s)&quot;) ggplot(midwest, aes(percbelowpoverty)) + geom_histogram(aes(weight = poptotal/1e6), binwidth = 1) + ylab(&quot;Population (millions)&quot;) "],["displaying-distributions.html", "6.4 Displaying distributions", " 6.4 Displaying distributions Using built-in diamonds dataset Figure 6.1: Diamond Dimensions For 1-Dimensional continuous data (1d), the histogram is arguably the most important geom ggplot(diamonds, aes(depth)) + geom_histogram() ## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`. ggplot(diamonds, aes(depth)) + geom_histogram(binwidth = 0.1) + xlim(55, 70) ## Warning: Removed 45 rows containing non-finite values (stat_bin). ## Warning: Removed 2 rows containing missing values (geom_bar). Never rely on the defaults. Always adjust your bin or xlim to “zoom” in our out of your data. There is no hard or fast rule, only experimentation to discover coorelation in your plot. For your audience/reader, ensure you add a caption for your scale, for example binwidth. Three ways to compare distribution: - Show small multiples of the histogram, facet_wrap(~ var). - Use colour and a frequency polygon, geom_freqpoly(). - Use a “conditional density plot”, geom_histogram(position = \"fill\"). ggplot(diamonds, aes(depth)) + geom_freqpoly(aes(colour = cut), binwidth = 0.1, na.rm = TRUE) + xlim(58, 68) + theme(legend.position = &quot;none&quot;) ggplot(diamonds, aes(depth)) + geom_histogram(aes(fill = cut), binwidth = 0.1, position = &quot;fill&quot;, na.rm = TRUE) + xlim(58, 68) + theme(legend.position = &quot;none&quot;) You can also plot density using geom_density(). Use a density plot when you know that the underlying density is smooth, continuous and unbounded. ggplot(diamonds, aes(depth)) + geom_density(na.rm = TRUE) + xlim(58, 68) + theme(legend.position = &quot;none&quot;) ggplot(diamonds, aes(depth, fill = cut, colour = cut)) + geom_density(alpha = 0.2, na.rm = TRUE) + xlim(58, 68) + theme(legend.position = &quot;none&quot;) It is often the case and advisable to sacrifice quality for quantity. The following three types of graph provide examples of this thought. geom_boxplot(): ggplot(diamonds, aes(clarity, depth)) + geom_boxplot() ggplot(diamonds, aes(carat, depth)) + geom_boxplot(aes(group = cut_width(carat, 0.1))) + xlim(NA, 2.05) ## Warning: Removed 997 rows containing missing values (stat_boxplot). geom_violin(): ggplot(diamonds, aes(clarity, depth)) + geom_violin() ggplot(diamonds, aes(carat, depth)) + geom_violin(aes(group = cut_width(carat, 0.1))) + xlim(NA, 2.05) ## Warning: Removed 997 rows containing non-finite values (stat_ydensity). geom_dotplot(): 6.4.1 Exercise: What binwidth tells you the most interesting story about the distribution of carat? &gt;The number of bins or the binwidth should be exploration exercise. There is not direct hard or fast rule for scaling the binwidth. What is important is to find the appropriate size that best captures the representation (or distribution) of your analysis. This correlates to your story as you are explaining the importance. Find a binwidth that best captures your ideas. Draw a histogram of price. What interesting patterns do you see? ggplot(diamonds, aes(price)) + geom_histogram(binwidth = 5) The smaller the quantity (assuming quality), the higher the price. I presume that carat size would also have a strong correlation with quantity and price. How does the distribution of price vary with clarity? ggplot(diamonds, aes(clarity, price)) + geom_violin() ggplot(diamonds, aes(clarity, price)) + geom_boxplot() I presume using different geoms, the higher the clarity, the higher the price, the fewer the quantity. Overlay a frequency polygon and density plot of depth. What computed variable do you need to map to y to make the two plots comparable? (You can either modify geom_freqpoly() or geom_density().) Not completed. "],["dealing-with-overplotting.html", "6.5 Dealing with overplotting", " 6.5 Dealing with overplotting Scatterplot is a very important tool for assessing relationship Too large a dataset may obscure any true relationship This is called Over plotting To compensate for Over plotting, tweaking the aesthetic can help. Techniques like hollow glyphs can help. df &lt;- data.frame(x = rnorm(2000), y = rnorm(2000)) norm &lt;- ggplot(df, aes(x, y)) + xlab(NULL) + ylab(NULL) norm + geom_point() norm + geom_point(shape = 1) # Hollow circles norm + geom_point(shape = 96) # Pixel sized Alternative ways using large data sets, you can use alpha blending (transparency). If you specify alpha as a ratio, the denominator gives the number of points that must be over plotted to give a solid color. norm + geom_point(alpha = 1 / 3) norm + geom_point(alpha = 1 / 5) norm + geom_point(alpha = 1 / 10) geom_jitter() can be used if your data has some discreteness. By default, 40% is used. You can overide the default with width and height arguments. Alternatively, we can think of overplotting as a 2d density estimation problem, which gives rise to two more approaches: Bin the points and count the number in each bin, then visualise that count (the 2d generalisation of the histogram), geom_bin2d(). The code below compares square and hexagonal bins, using parameters bins and binwidth to control the number and size of the bins. norm + geom_bin2d() norm + geom_bin2d(bins = 10) library(hexbin) norm + geom_hex() norm + geom_hex(bins = 10) Another approach to dealing with overplotting is to add data summaries to help guide the eye to the true shape of the pattern within the data. "],["statistical-summaries-1.html", "6.6 Statistical Summaries", " 6.6 Statistical Summaries geom_histogram() and geom_bin2d() use a familiar geom, geom_bar() and geom_raster(), combined with a new statistical transformation, stat_bin() and stat_bin2d(). stat_bin() and stat_bin2d() combine the data into bins and count the number of observations in each bin. But what if we want a summary other than count? So far, we’ve just used the default statistical transformation associated with each geom. Now we’re going to explore how to use stat_summary_bin() to stat_summary_2d() to compute different summaries. ggplot(diamonds, aes(color)) + geom_bar() ggplot(diamonds, aes(color, price)) + geom_bar(stat = &quot;summary_bin&quot;, fun = mean) ggplot(diamonds, aes(table, depth)) + geom_bin2d(binwidth = 1, na.rm = TRUE) + xlim(50, 70) + ylim(50, 70) ggplot(diamonds, aes(table, depth, z = price)) + geom_raster(binwidth = 1, stat = &quot;summary_2d&quot;, fun = mean, na.rm = TRUE) + xlim(50, 70) + ylim(50, 70) ## Warning: Raster pixels are placed at uneven horizontal intervals and will be ## shifted. Consider using geom_tile() instead. ## Warning: Raster pixels are placed at uneven vertical intervals and will be ## shifted. Consider using geom_tile() instead. So far we’ve considered two classes of geoms: Simple geoms where there’s a one-on-one correspondence between rows in the data frame and physical elements of the geom Statistical geoms where introduce a layer of statistical summaries in between the raw data and the result Although ggplot2 does not have direct 3d support, it does provide the ability to plot 2d images representing 3d data. These include: contours, colored tiles, and bubble plots. ggplot(faithfuld, aes(eruptions, waiting)) + geom_contour(aes(z = density, colour = ..level..)) ggplot(faithfuld, aes(eruptions, waiting)) + geom_raster(aes(fill = density)) # Bubble plots work better with fewer observations small &lt;- faithfuld[seq(1, nrow(faithfuld), by = 10), ] ggplot(small, aes(eruptions, waiting)) + geom_point(aes(size = density), alpha = 1/3) + scale_size_area() "],["maps.html", "Chapter 7 Maps", " Chapter 7 Maps Learning Objectives: - Plot simple maps using geom_polygon() - Using simple features sf to plot GIS data geom_sf() - Work with map projections and underlying sf data structure - Draw maps using Raster data Plotting geospacial data is a common visualization task. The process may require spcialized tools. You can decompse the problem into two paths: - Using one data source to draw a map (if you have GIS data) - Adding metadata from another information source to the map (more common with relation to geographic areas) NOTE: X = Longitude, Y=Latitude. When pronounced “Lat/Lon” it is actually measured as Y/X. Not confusing….just keeping with vocabulary and measurements! "],["polygon-maps.html", "7.1 Polygon Maps", " 7.1 Polygon Maps The simplest approach to mapping is using geom_polygon(). This forms bounderies around regions. library(ggplot2) mi_counties &lt;- map_data(&quot;county&quot;, &quot;michigan&quot;) %&gt;% select(lon = long, lat, group, id = subregion) head(mi_counties) ## lon lat group id ## 1 -83.88675 44.85686 1 alcona ## 2 -83.36536 44.86832 1 alcona ## 3 -83.36536 44.86832 1 alcona ## 4 -83.33098 44.83968 1 alcona ## 5 -83.30806 44.80530 1 alcona ## 6 -83.30233 44.77665 1 alcona In this data set we have four variables: - lat: Latitude of the vertex (as measured by horizontal paths) - long: Longitude of the vertex (as measured by vertical paths) - id: name of the region - group: unique identifier for contiguous areas within a region ggplot(mi_counties, aes(lon, lat)) + geom_point(size = .25, show.legend = FALSE) + coord_quickmap() ggplot(mi_counties, aes(lon, lat, group = group)) + geom_polygon(fill = &quot;white&quot;, colour = &quot;grey50&quot;) + coord_quickmap() In this plot, coord_quickmap() is used to adjust the axes to ensure longitude and latitude are rendered on the same scale For a more advanced use of ggplot2 for mapping, we’ll see the use of geom_sf() and coord_sf() to handle spatial data specified in simple features format. "],["simple-features-maps.html", "7.2 Simple Features Maps", " 7.2 Simple Features Maps You can use the above examples…but not real world pratical. Instead, most GIS data is written as simple features and produced by the (Open Geospatial Consortium]https://www.ogc.org/) 7.2.1 Layered Maps 7.2.2 Labelled Maps 7.2.3 Adding Other Geoms "],["map-projections.html", "7.3 Map Projections", " 7.3 Map Projections "],["working-with-sf-data.html", "7.4 Working with sf Data", " 7.4 Working with sf Data "],["raster-maps.html", "7.5 Raster Maps", " 7.5 Raster Maps "],["data-sources.html", "7.6 Data Sources", " 7.6 Data Sources "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
